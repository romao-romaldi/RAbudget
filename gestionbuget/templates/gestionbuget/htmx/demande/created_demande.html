<div>
    <form hx-post="{% url 'gestionbudget:create_demande' budget_sheet.pid %}" hx-target="#demande-created" 
    hx-trigger="submit" hx-oob="true" hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}' id="demande-created"
    @htmx:after-request="handleAddBudget" >
        <div class="mb-4">
            <label for="title" class="block text-sm font-medium text-gray-700 mb-1">Titre de la demande</label>
            <input type="text" id="title" name="title" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400" required>
        </div>
        <div class="mb-4">
            <label for="amount" class="block text-sm font-medium text-gray-700 mb-1">Montant</label>
            <input type="number" id="id_amount_spent" name="amount_spent" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400" required>
        </div>
        <div class="mb-4">
            <label for="description" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
            <textarea  name="description" rows="4" id="id_description"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"></textarea>
        </div>
        <div class="mb-4">
            <label for="file" class="block text-sm font-medium text-gray-700 mb-1">Lier un fichier</label>
            <input type="file" id="file" name="file" id="id_file"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400">
        </div>

        <div class="mb-4">
            <label for="due_date" class="block text-sm font-medium text-gray-700 mb-1">Qui valide ?</label>
            <select name="user_validateur" id=""
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400" required>
                <option value="" disabled selected>Choisir le validateur</option>
                {% for partenaire in partenaires %}
                    <option value="{{ partenaire.pid }}" >
                        {% if partenaire.user.first_name %}
                            {{ partenaire.user.first_name }} {{ partenaire.user.last_name }}
                        {% else %}
                            {{ partenaire.user.user.username }}
                        {% endif %}
                    </option>
                {% endfor %}
            </select>
        </div>

        <template x-if="demande_type_budget" class="mb-4">
            <input type="text" name="type_budget"   x-model="demande_type_budget.pid" hidden>
        </template>

        <template x-if="!demande_type_budget" class="mb-4">
            <select name="type_budget" id="id_type_budget"
            class="w-full px-3 py-2 mb-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400" required>
                    <option value="" disabled selected>Choisir le type de budget</option>
                    {% for type_budget in type_budgets %}
                        {% if type_budget.is_spent %}
                            <option value="{{ type_budget.pid }}" >{{ type_budget.name }}</option>
                        {% endif %}
                    {% endfor %}
            </select>
        </template>
        <div class="flex justify-end mt-3">
            <button type="submit" class="px-4 py-2 bg-teal-700 text-white rounded-lg hover:bg-teal-500">CrÃ©er la demande</button>
        </div>
    </form>
</div>